<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Hugh Parsonage" />

<meta name="date" content="2017-09-17" />

<title>Hutils</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Hutils</h1>
<h4 class="author"><em>Hugh Parsonage</em></h4>
<h4 class="date"><em>2017-09-17</em></h4>



<div id="hutils-package" class="section level1">
<h1><code>hutils</code> package</h1>
<p>My name is Hugh. I’ve written some miscellaneous functions that don’t seem to belong in a particular package. I’ve usually put these in <code>R/utils.R</code> when I write a package. Thus, <code>hutils</code>.</p>
<p>This vignette just goes through each exported function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(knitr)
suggested_packages &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;geosphere&quot;</span>, <span class="st">&quot;nycflights13&quot;</span>, <span class="st">&quot;dplyr&quot;</span>, <span class="st">&quot;ggplot2&quot;</span>, <span class="st">&quot;microbenchmark&quot;</span>)
opts_chunk$<span class="kw">set</span>(<span class="dt">eval =</span> <span class="kw">all</span>(<span class="kw">vapply</span>(suggested_packages, requireNamespace, <span class="dt">quietly =</span> <span class="ot">TRUE</span>, <span class="dt">FUN.VALUE =</span> <span class="ot">FALSE</span>)))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(geosphere)
<span class="kw">library</span>(nycflights13)
<span class="kw">library</span>(dplyr, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)
<span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(microbenchmark)
<span class="kw">library</span>(data.table, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)
<span class="kw">library</span>(magrittr)
<span class="kw">library</span>(hutils, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)</code></pre></div>
<div id="aliases" class="section level2">
<h2>Aliases</h2>
<p>These are simple additions to <code>magrittr</code>‘s aliases. Two new features: capitalized forms of <code>and</code> and <code>or</code> that invoke <code>&amp;&amp;</code> and <code>||</code>, the ’long-form’ logical operators, and <code>nor</code> / <code>neither</code> functions.</p>
<p>The main motivation is to make the source code easier to indent. I occasionally such source code easier to use.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">OR</span>(<span class="kw">OR</span>(<span class="ot">TRUE</span>,
      <span class="kw">stop</span>(<span class="st">&quot;Never happens&quot;</span>)),  ## short-circuits
   <span class="kw">AND</span>(<span class="ot">FALSE</span>,
       <span class="kw">stop</span>(<span class="st">&quot;Never happens&quot;</span>)))  </code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p><code>nor</code> (or <code>neither</code> which is identical) returns <code>TRUE</code> if and only if both arguments are <code>FALSE</code>.</p>
</div>
<div id="coalesce-and-if_else" class="section level2">
<h2><code>coalesce</code> and <code>if_else</code></h2>
<p>These are near drop-in replacements for the equivalent functions from <code>dplyr</code>. They are included here because they are very useful outside of the tidyverse, but may be required in circumstances where importing <code>dplyr</code> (with all of its dependencies) would be inappropriate.</p>
<p>They attempt to be drop-in replacements but:</p>
<ol style="list-style-type: decimal">
<li><code>hutils::if_else</code> only works with <code>logical</code>, <code>integer</code>, <code>double</code>, and <code>character</code> type vectors. Lists and factors won’t work.</li>
<li><code>hutils::coalesce</code> short-circuits on its first argument; if there are no <code>NA</code>s in <code>x</code>, then <code>x</code> is returned, even if the other vectors are the wrong length or type.</li>
</ol>
<p>In addition, <code>hutils::if_else</code> is generally faster than <code>dplyr::if_else</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_check &lt;-<span class="st"> </span>function(values) {
  <span class="kw">all</span>(<span class="kw">vapply</span>(values[-<span class="dv">1</span>], function(x) <span class="kw">identical</span>(values[[<span class="dv">1</span>]], x), <span class="kw">logical</span>(<span class="dv">1</span>)))
}


cnd &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
yes &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
no &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
na &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)

<span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr::<span class="kw">if_else</span>(cnd, yes, no, na),
               <span class="dt">hutils =</span> hutils::<span class="kw">if_else</span>(cnd, yes, no, na),
               <span class="dt">check =</span> my_check) %T&gt;%
<span class="st">  </span>print %&gt;%
<span class="st">  </span>autoplot</code></pre></div>
<pre><code>## Unit: milliseconds
##    expr      min       lq     mean   median       uq       max neval cld
##   dplyr 5.620259 5.837859 8.347760 7.666302 8.069729  22.09372   100   b
##  hutils 2.945508 3.121697 5.143086 3.851900 4.031251 101.91669   100  a</code></pre>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cnd &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
yes &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
no &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
na &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)

<span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr::<span class="kw">if_else</span>(cnd, yes, no, na),
               <span class="dt">hutils =</span> hutils::<span class="kw">if_else</span>(cnd, yes, no, na),
               <span class="dt">check =</span> my_check) %T&gt;%
<span class="st">  </span>print %&gt;%
<span class="st">  </span>autoplot</code></pre></div>
<pre><code>## Unit: milliseconds
##    expr      min       lq     mean   median       uq       max neval cld
##   dplyr 4.539335 4.641134 8.265891 6.187525 6.516561 173.61150   100   b
##  hutils 1.836575 1.892444 2.572916 2.410318 2.615268  11.74318   100  a</code></pre>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>This speed advantage also appears to be true of <code>coalesce</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
A &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
B &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
C &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)

<span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr::<span class="kw">coalesce</span>(x, A, B, C),
               <span class="dt">hutils =</span> hutils::<span class="kw">coalesce</span>(x, A, B, C),
               <span class="dt">check =</span> my_check) %T&gt;%
<span class="st">  </span>print %&gt;%
<span class="st">  </span>autoplot</code></pre></div>
<pre><code>## Unit: microseconds
##    expr      min       lq     mean   median       uq       max neval cld
##   dplyr 1814.288 2026.769 7009.141 3112.511 3382.667 329595.43   100   a
##  hutils  827.934  918.589 1540.585 1276.537 1387.070  10218.02   100   a</code></pre>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<p>especially during short-circuits:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)

<span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr::<span class="kw">coalesce</span>(x, A, B, C),
               <span class="dt">hutils =</span> hutils::<span class="kw">coalesce</span>(x, A, B, C),
               <span class="dt">check =</span> my_check) %T&gt;%
<span class="st">  </span>print %&gt;%
<span class="st">  </span>autoplot</code></pre></div>
<pre><code>## Unit: microseconds
##    expr      min        lq       mean   median       uq        max neval
##   dplyr 1661.893 2251.2960 7469.65812 3017.038 3264.304 278333.348   100
##  hutils   46.683   54.6635   73.74623   60.085   75.445    200.584   100
##  cld
##    b
##   a</code></pre>
<p><img src="data:image/png;base64,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" /><!-- --></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
A &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)

<span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr::<span class="kw">coalesce</span>(x, A, B, C),
               <span class="dt">hutils =</span> hutils::<span class="kw">coalesce</span>(x, A, B, C),
               <span class="dt">check =</span> my_check) %T&gt;%
<span class="st">  </span>print %&gt;%
<span class="st">  </span>autoplot</code></pre></div>
<pre><code>## Unit: microseconds
##    expr      min       lq      mean   median       uq        max neval cld
##   dplyr 1769.714 2149.347 4780.9604 3054.082 3363.842 116776.445   100   b
##  hutils  562.598  624.490  910.8519  814.382  888.622   9071.744   100  a</code></pre>
<p><img src="data:image/png;base64,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" /><!-- --></p>
</div>
<div id="drop-columns" class="section level2">
<h2>Drop columns</h2>
<p>To drop a column from a <code>data.table</code>, you set it to <code>NULL</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">A =</span> <span class="dv">1</span>:<span class="dv">5</span>, <span class="dt">B =</span> <span class="dv">1</span>:<span class="dv">5</span>, <span class="dt">C =</span> <span class="dv">1</span>:<span class="dv">5</span>)
DT[, A :<span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</code></pre></div>
<p>There’s nothing wrong with this, but I’ve found the following a useful alias, especially in a <code>magrittr</code> pipe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">A =</span> <span class="dv">1</span>:<span class="dv">5</span>, <span class="dt">B =</span> <span class="dv">1</span>:<span class="dv">5</span>, <span class="dt">C =</span> <span class="dv">1</span>:<span class="dv">5</span>)
DT %&gt;%
<span class="st">  </span><span class="kw">drop_col</span>(<span class="st">&quot;A&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">drop_col</span>(<span class="st">&quot;B&quot;</span>)

<span class="co"># or</span>
DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">A =</span> <span class="dv">1</span>:<span class="dv">5</span>, <span class="dt">B =</span> <span class="dv">1</span>:<span class="dv">5</span>, <span class="dt">C =</span> <span class="dv">1</span>:<span class="dv">5</span>)
DT %&gt;%
<span class="st">  </span><span class="kw">drop_cols</span>(<span class="kw">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>))</code></pre></div>
<p>These functions simple invoke the canonical form, so won’t be any faster.</p>
<p>Additionally, one can drop columns by a regular expression using <code>drop_colr</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(flights)

flights %&gt;%
<span class="st">  </span><span class="kw">drop_colr</span>(<span class="st">&quot;time&quot;</span>) %&gt;%
<span class="st">  </span><span class="kw">drop_colr</span>(<span class="st">&quot;arr(?!_delay)&quot;</span>, <span class="dt">perl =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##         year month day dep_delay arr_delay flight tailnum origin dest
##      1: 2013     1   1         2        11   1545  N14228    EWR  IAH
##      2: 2013     1   1         4        20   1714  N24211    LGA  IAH
##      3: 2013     1   1         2        33   1141  N619AA    JFK  MIA
##      4: 2013     1   1        -1       -18    725  N804JB    JFK  BQN
##      5: 2013     1   1        -6       -25    461  N668DN    LGA  ATL
##     ---                                                              
## 336772: 2013     9  30        NA        NA   3393      NA    JFK  DCA
## 336773: 2013     9  30        NA        NA   3525      NA    LGA  SYR
## 336774: 2013     9  30        NA        NA   3461  N535MQ    LGA  BNA
## 336775: 2013     9  30        NA        NA   3572  N511MQ    LGA  CLE
## 336776: 2013     9  30        NA        NA   3531  N839MQ    LGA  RDU
##         distance hour minute
##      1:     1400    5     15
##      2:     1416    5     29
##      3:     1089    5     40
##      4:     1576    5     45
##      5:      762    6      0
##     ---                     
## 336772:      213   14     55
## 336773:      198   22      0
## 336774:      764   12     10
## 336775:      419   11     59
## 336776:      431    8     40</code></pre>
</div>
<div id="drop_empty_cols" class="section level2">
<h2><code>drop_empty_cols</code></h2>
<p>This function drops columns in which all the values are <code>NA</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">planes %&gt;%<span class="st"> </span>
<span class="st">  </span>as.data.table %&gt;%<span class="st"> </span>
<span class="st">  </span>.[!<span class="kw">complete.cases</span>(.)]</code></pre></div>
<pre><code>##       tailnum year                    type                  manufacturer
##    1:  N10156 2004 Fixed wing multi engine                       EMBRAER
##    2:  N102UW 1998 Fixed wing multi engine              AIRBUS INDUSTRIE
##    3:  N103US 1999 Fixed wing multi engine              AIRBUS INDUSTRIE
##    4:  N104UW 1999 Fixed wing multi engine              AIRBUS INDUSTRIE
##    5:  N10575 2002 Fixed wing multi engine                       EMBRAER
##   ---                                                                   
## 3295:  N997AT 2002 Fixed wing multi engine                        BOEING
## 3296:  N997DL 1992 Fixed wing multi engine MCDONNELL DOUGLAS AIRCRAFT CO
## 3297:  N998AT 2002 Fixed wing multi engine                        BOEING
## 3298:  N998DL 1992 Fixed wing multi engine MCDONNELL DOUGLAS CORPORATION
## 3299:  N999DN 1992 Fixed wing multi engine MCDONNELL DOUGLAS CORPORATION
##           model engines seats speed    engine
##    1: EMB-145XR       2    55    NA Turbo-fan
##    2:  A320-214       2   182    NA Turbo-fan
##    3:  A320-214       2   182    NA Turbo-fan
##    4:  A320-214       2   182    NA Turbo-fan
##    5: EMB-145LR       2    55    NA Turbo-fan
##   ---                                        
## 3295:   717-200       2   100    NA Turbo-fan
## 3296:     MD-88       2   142    NA Turbo-fan
## 3297:   717-200       2   100    NA Turbo-fan
## 3298:     MD-88       2   142    NA Turbo-jet
## 3299:     MD-88       2   142    NA Turbo-jet</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">planes %&gt;%<span class="st"> </span>
<span class="st">  </span>as.data.table %&gt;%<span class="st"> </span>
<span class="st">  </span>.[!<span class="kw">complete.cases</span>(.)] %&gt;%<span class="st"> </span>
<span class="st">  </span><span class="co"># drops speed</span>
<span class="st">  </span>drop_empty_cols</code></pre></div>
<pre><code>##       tailnum year                    type                  manufacturer
##    1:  N10156 2004 Fixed wing multi engine                       EMBRAER
##    2:  N102UW 1998 Fixed wing multi engine              AIRBUS INDUSTRIE
##    3:  N103US 1999 Fixed wing multi engine              AIRBUS INDUSTRIE
##    4:  N104UW 1999 Fixed wing multi engine              AIRBUS INDUSTRIE
##    5:  N10575 2002 Fixed wing multi engine                       EMBRAER
##   ---                                                                   
## 3295:  N997AT 2002 Fixed wing multi engine                        BOEING
## 3296:  N997DL 1992 Fixed wing multi engine MCDONNELL DOUGLAS AIRCRAFT CO
## 3297:  N998AT 2002 Fixed wing multi engine                        BOEING
## 3298:  N998DL 1992 Fixed wing multi engine MCDONNELL DOUGLAS CORPORATION
## 3299:  N999DN 1992 Fixed wing multi engine MCDONNELL DOUGLAS CORPORATION
##           model engines seats    engine
##    1: EMB-145XR       2    55 Turbo-fan
##    2:  A320-214       2   182 Turbo-fan
##    3:  A320-214       2   182 Turbo-fan
##    4:  A320-214       2   182 Turbo-fan
##    5: EMB-145LR       2    55 Turbo-fan
##   ---                                  
## 3295:   717-200       2   100 Turbo-fan
## 3296:     MD-88       2   142 Turbo-fan
## 3297:   717-200       2   100 Turbo-fan
## 3298:     MD-88       2   142 Turbo-jet
## 3299:     MD-88       2   142 Turbo-jet</code></pre>
</div>
<div id="duplicated_rows" class="section level2">
<h2><code>duplicated_rows</code></h2>
<p>There are many useful functions for detecting duplicates in R. However, in interactive use, I often want to not merely see which values are duplicated, but also compare them to the original. This is especially true when I am comparing duplicates across a <em>subset</em> of columns in a a <code>data.table</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights %&gt;%
<span class="st">  </span><span class="co"># only the 'second' of the duplicates is returned</span>
<span class="st">  </span>.[<span class="kw">duplicated</span>(., <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;origin&quot;</span>, <span class="st">&quot;dest&quot;</span>))]  </code></pre></div>
<pre><code>##         year month day dep_time sched_dep_time dep_delay arr_time
##      1: 2013     1   1      600            600         0      837
##      2: 2013     1   1      607            607         0      858
##      3: 2013     1   1      608            600         8      807
##      4: 2013     1   1      623            627        -4      933
##      5: 2013     1   1      624            630        -6      840
##     ---                                                          
## 336548: 2013     9  30       NA           1455        NA       NA
## 336549: 2013     9  30       NA           2200        NA       NA
## 336550: 2013     9  30       NA           1210        NA       NA
## 336551: 2013     9  30       NA           1159        NA       NA
## 336552: 2013     9  30       NA            840        NA       NA
##         sched_arr_time arr_delay carrier flight tailnum origin dest
##      1:            825        12      MQ   4650  N542MQ    LGA  ATL
##      2:            915       -17      UA   1077  N53442    EWR  MIA
##      3:            735        32      MQ   3768  N9EAMQ    EWR  ORD
##      4:            932         1      UA    496  N459UA    LGA  IAH
##      5:            830        10      MQ   4599  N518MQ    LGA  MSP
##     ---                                                            
## 336548:           1634        NA      9E   3393      NA    JFK  DCA
## 336549:           2312        NA      9E   3525      NA    LGA  SYR
## 336550:           1330        NA      MQ   3461  N535MQ    LGA  BNA
## 336551:           1344        NA      MQ   3572  N511MQ    LGA  CLE
## 336552:           1020        NA      MQ   3531  N839MQ    LGA  RDU
##         air_time distance hour minute           time_hour
##      1:      134      762    6      0 2013-01-01 06:00:00
##      2:      157     1085    6      7 2013-01-01 06:00:00
##      3:      139      719    6      0 2013-01-01 06:00:00
##      4:      229     1416    6     27 2013-01-01 06:00:00
##      5:      166     1020    6     30 2013-01-01 06:00:00
##     ---                                                  
## 336548:       NA      213   14     55 2013-09-30 14:00:00
## 336549:       NA      198   22      0 2013-09-30 22:00:00
## 336550:       NA      764   12     10 2013-09-30 12:00:00
## 336551:       NA      419   11     59 2013-09-30 11:00:00
## 336552:       NA      431    8     40 2013-09-30 08:00:00</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights %&gt;%
<span class="st">  </span><span class="co"># Both rows are returned and (by default)</span>
<span class="st">  </span><span class="co"># duplicates are presented adjacently</span>
<span class="st">  </span><span class="kw">duplicated_rows</span>(<span class="dt">by =</span> <span class="kw">c</span>(<span class="st">&quot;origin&quot;</span>, <span class="st">&quot;dest&quot;</span>))</code></pre></div>
<pre><code>##         year month day dep_time sched_dep_time dep_delay arr_time
##      1: 2013     1   1     1315           1317        -2     1413
##      2: 2013     1   1     1655           1621        34     1804
##      3: 2013     1   1     2056           2004        52     2156
##      4: 2013     1   2     1332           1327         5     1419
##      5: 2013     1   2     1746           1621        85     1835
##     ---                                                          
## 336767: 2013     9  27     1516           1520        -4     1739
## 336768: 2013     9  29     1754           1755        -1     2019
## 336769: 2013     9  30      719            725        -6      916
## 336770: 2013     9  30     1519           1520        -1     1726
## 336771: 2013     9  30     1747           1755        -8     1941
##         sched_arr_time arr_delay carrier flight tailnum origin dest
##      1:           1423       -10      EV   4112  N13538    EWR  ALB
##      2:           1724        40      EV   3260  N19554    EWR  ALB
##      3:           2112        44      EV   4170  N12540    EWR  ALB
##      4:           1433       -14      EV   4316  N14153    EWR  ALB
##      5:           1724        71      EV   3260  N14153    EWR  ALB
##     ---                                                            
## 336767:           1740        -1      MQ   3532  N724MQ    LGA  XNA
## 336768:           2015         4      MQ   3713  N725MQ    LGA  XNA
## 336769:            945       -29      MQ   3547  N735MQ    LGA  XNA
## 336770:           1740       -14      MQ   3532  N725MQ    LGA  XNA
## 336771:           2015       -34      MQ   3713  N720MQ    LGA  XNA
##         air_time distance hour minute           time_hour
##      1:       33      143   13     17 2013-01-01 13:00:00
##      2:       36      143   16     21 2013-01-01 16:00:00
##      3:       31      143   20      4 2013-01-01 20:00:00
##      4:       33      143   13     27 2013-01-02 13:00:00
##      5:       31      143   16     21 2013-01-02 16:00:00
##     ---                                                  
## 336767:      160     1147   15     20 2013-09-27 15:00:00
## 336768:      160     1147   17     55 2013-09-29 17:00:00
## 336769:      150     1147    7     25 2013-09-30 07:00:00
## 336770:      148     1147   15     20 2013-09-30 15:00:00
## 336771:      146     1147   17     55 2013-09-30 17:00:00</code></pre>
</div>
<div id="haversine-distance" class="section level2">
<h2>Haversine distance</h2>
<p>To emphasize the miscellany of this package, I now present <code>haversine_distance</code> which simply returns the distance between two points on the Earth, given their latitutde and longitude.</p>
<p>I prefer this to other packages’ implementations. Although the <code>geosphere</code> package can do a lot more than calculate distances between points, I find the interface for <code>distHaversine</code> unfortunate as it cannot be easily used inside a <code>data.frame</code>. In addition, I’ve found the arguments clearer in <code>hutils::haversine_distance</code> rather than trying to remember whether to use <code>byrow</code> inside the <code>matrix</code> function while passing to <code>distHaversine</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT1 &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">lat_orig =</span> <span class="kw">runif</span>(<span class="fl">1e5</span>, -<span class="dv">80</span>, <span class="dv">80</span>),
                 <span class="dt">lon_orig =</span> <span class="kw">runif</span>(<span class="fl">1e5</span>, -<span class="dv">179</span>, <span class="dv">179</span>),
                 <span class="dt">lat_dest =</span> <span class="kw">runif</span>(<span class="fl">1e5</span>, -<span class="dv">80</span>, <span class="dv">80</span>),
                 <span class="dt">lon_dest =</span> <span class="kw">runif</span>(<span class="fl">1e5</span>, -<span class="dv">179</span>, <span class="dv">179</span>))

DT2 &lt;-<span class="st"> </span><span class="kw">copy</span>(DT1)

<span class="kw">microbenchmark</span>(DT1[, distance :<span class="er">=</span><span class="st"> </span><span class="kw">haversine_distance</span>(lat_orig, lon_orig,
                                                    lat_dest, lon_dest)],
               
               DT2[, distance :<span class="er">=</span><span class="st"> </span><span class="kw">distHaversine</span>(<span class="kw">cbind</span>(lon_orig, lat_orig),
                                               <span class="kw">cbind</span>(lon_orig, lat_orig))])</code></pre></div>
<pre><code>## Unit: milliseconds
##                                                                                             expr
##           DT1[, `:=`(distance, haversine_distance(lat_orig, lon_orig, lat_dest,      lon_dest))]
##  DT2[, `:=`(distance, distHaversine(cbind(lon_orig, lat_orig),      cbind(lon_orig, lat_orig)))]
##       min       lq     mean   median       uq      max neval cld
##  18.02211 19.34383 21.95963 22.18648 22.52425  32.5316   100  a 
##  47.04982 56.88595 68.97913 63.17513 68.99265 233.7077   100   b</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(DT1, DT2)</code></pre></div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
