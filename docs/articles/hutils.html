<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hutils • hutils</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Hutils">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hutils</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/hutils.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/hughparsonage/hutils">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Hutils</h1>
                        <h4 class="author">Hugh Parsonage</h4>
            
            <h4 class="date">2018-10-18</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hughparsonage/hutils/blob/master/vignettes/hutils.Rmd"><code>vignettes/hutils.Rmd</code></a></small>
      <div class="hidden name"><code>hutils.Rmd</code></div>

    </div>

    
    
<div id="hutils-package" class="section level1">
<h1 class="hasAnchor">
<a href="#hutils-package" class="anchor"></a><code>hutils</code> package</h1>
<p>My name is Hugh. I’ve written some miscellaneous functions that don’t seem to belong in a particular package. I’ve usually put these in <code>R/utils.R</code> when I write a package. Thus, <code>hutils</code>.</p>
<p>This vignette just goes through each exported function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(knitr)
suggested_packages &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"geosphere"</span>, <span class="st">"nycflights13"</span>, <span class="st">"dplyr"</span>, <span class="st">"ggplot2"</span>, <span class="st">"microbenchmark"</span>)
opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">eval =</span> <span class="kw">all</span>(<span class="kw">vapply</span>(suggested_packages, requireNamespace, <span class="dt">quietly =</span> <span class="ot">TRUE</span>, <span class="dt">FUN.VALUE =</span> <span class="ot">FALSE</span>)))</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tryCatch</span>({
  <span class="kw">library</span>(geosphere)
  <span class="kw">library</span>(nycflights13)
  <span class="kw">library</span>(dplyr, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)
  <span class="kw">library</span>(ggplot2)
  <span class="kw">library</span>(microbenchmark)
  <span class="kw">library</span>(data.table, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)
  <span class="kw">library</span>(magrittr)
  <span class="kw">library</span>(hutils, <span class="dt">warn.conflicts =</span> <span class="ot">FALSE</span>)
}, 
<span class="co"># requireNamespace does not detect errors like</span>
<span class="co"># package ‘dplyr’ was installed by an R version with different internals; it needs to be reinstalled for use with this R version</span>
<span class="dt">error =</span> <span class="cf">function</span>(e) {
  opts_chunk<span class="op">$</span><span class="kw">set</span>(<span class="dt">eval =</span> <span class="ot">FALSE</span>)
})
<span class="kw">options</span>(<span class="dt">digits =</span> <span class="dv">4</span>)</code></pre></div>
<div id="aliases" class="section level2">
<h2 class="hasAnchor">
<a href="#aliases" class="anchor"></a>Aliases</h2>
<p>These are simple additions to <code>magrittr</code>‘s aliases, including: capitalized forms of <code>and</code> and <code>or</code> that invoke <code>&amp;&amp;</code> and <code>||</code> (the ’long-form’ logical operators) and <code>nor</code> / <code>neither</code> functions.</p>
<p>The main motivation is to make the source code easier to indent. I occasionally find such source code easier to use.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/aliases.html">OR</a></span>(<span class="kw"><a href="../reference/aliases.html">OR</a></span>(<span class="ot">TRUE</span>,
      <span class="kw">stop</span>(<span class="st">"Never happens"</span>)),  ## short-circuits
   <span class="kw"><a href="../reference/aliases.html">AND</a></span>(<span class="ot">FALSE</span>,
       <span class="kw">stop</span>(<span class="st">"Never happens"</span>)))  </code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p><code>nor</code> (or <code>neither</code> which is identical) returns <code>TRUE</code> if and only if both arguments are <code>FALSE</code>.</p>
</div>
<div id="coalesce-and-if_else" class="section level2">
<h2 class="hasAnchor">
<a href="#coalesce-and-if_else" class="anchor"></a><code>coalesce</code> and <code>if_else</code>
</h2>
<p>These are near drop-in replacements for the equivalent functions from <code>dplyr</code>. They are included here because they are very useful outside of the tidyverse, but may be required in circumstances where importing <code>dplyr</code> (with all of its dependencies) would be inappropriate.</p>
<p>They attempt to be drop-in replacements but:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/if_else.html">hutils::if_else</a></code> only works with <code>logical</code>, <code>integer</code>, <code>double</code>, and <code>character</code> type vectors. Lists and factors won’t work.</li>
<li>
<code><a href="../reference/coalesce.html">hutils::coalesce</a></code> short-circuits on its first argument; if there are no <code>NA</code>s in <code>x</code> then <code>x</code> is returned, even if the other vectors are the wrong length or type.</li>
</ol>
<p>In addition, <code><a href="../reference/if_else.html">hutils::if_else</a></code> is generally faster than <code><a href="http://dplyr.tidyverse.org/reference/if_else.html">dplyr::if_else</a></code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">my_check &lt;-<span class="st"> </span><span class="cf">function</span>(values) {
  <span class="kw">all</span>(<span class="kw">vapply</span>(values[<span class="op">-</span><span class="dv">1</span>], <span class="cf">function</span>(x) <span class="kw">identical</span>(values[[<span class="dv">1</span>]], x), <span class="kw">logical</span>(<span class="dv">1</span>)))
}

<span class="kw">set.seed</span>(<span class="dv">2</span>)
cnd &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
yes &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
no &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
na &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)

<span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span>(cnd, yes, no, na),
               <span class="dt">hutils =</span> hutils<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/hutils/topics/if_else">if_else</a></span>(cnd, yes, no, na),
               <span class="dt">check =</span> my_check) <span class="op">%&gt;%</span>
<span class="st">  </span>print</code></pre></div>
<pre><code>## Unit: milliseconds
##    expr   min    lq  mean median    uq    max neval cld
##   dplyr 5.149 5.323 7.040  6.740 7.912 13.729   100   b
##  hutils 1.906 1.998 2.691  2.132 2.505  9.327   100  a</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cnd &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(<span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
yes &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
no &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
na &lt;-<span class="st"> </span><span class="kw">sample</span>(letters, <span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)

<span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span>(cnd, yes, no, na),
               <span class="dt">hutils =</span> hutils<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/hutils/topics/if_else">if_else</a></span>(cnd, yes, no, na),
               <span class="dt">check =</span> my_check) <span class="op">%&gt;%</span>
<span class="st">  </span>print</code></pre></div>
<pre><code>## Unit: milliseconds
##    expr   min    lq  mean median    uq     max neval cld
##   dplyr 5.061 5.500 8.730  5.644 9.982 131.856   100   b
##  hutils 1.188 1.409 1.906  1.439 1.483   8.069   100  a</code></pre>
<p>This speed advantage also appears to be true of <code>coalesce</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
A &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
B &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
C &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)

<span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span>(x, A, B, C),
               <span class="dt">hutils =</span> hutils<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/hutils/topics/coalesce">coalesce</a></span>(x, A, B, C),
               <span class="dt">check =</span> my_check) <span class="op">%&gt;%</span>
<span class="st">  </span>print</code></pre></div>
<pre><code>## Unit: milliseconds
##    expr   min    lq  mean median    uq     max neval cld
##   dplyr 2.603 2.672 5.419  2.708 6.755 128.573   100   b
##  hutils 1.166 1.271 2.301  1.314 1.347   7.627   100  a</code></pre>
<p>especially during short-circuits:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)

<span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span>(x, A, B, C),
               <span class="dt">hutils =</span> hutils<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/hutils/topics/coalesce">coalesce</a></span>(x, A, B, C),
               <span class="dt">check =</span> my_check) <span class="op">%&gt;%</span>
<span class="st">  </span>print</code></pre></div>
<pre><code>## Unit: microseconds
##    expr     min      lq    mean  median      uq   max neval cld
##   dplyr 2352.49 2515.27 4022.93 2552.47 6615.64 10126   100   b
##  hutils   58.13   61.44   72.25   69.57   79.96   153   100  a</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters, <span class="ot">NA</span>), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)
A &lt;-<span class="st"> </span><span class="kw">sample</span>(<span class="kw">c</span>(letters), <span class="dt">size =</span> <span class="fl">100e3</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>)

<span class="kw">microbenchmark</span>(<span class="dt">dplyr =</span>  dplyr<span class="op">::</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/coalesce.html">coalesce</a></span>(x, A, B, C),
               <span class="dt">hutils =</span> hutils<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/hutils/topics/coalesce">coalesce</a></span>(x, A, B, C),
               <span class="dt">check =</span> my_check) <span class="op">%&gt;%</span>
<span class="st">  </span>print</code></pre></div>
<pre><code>## Unit: microseconds
##    expr    min     lq mean median     uq    max neval cld
##   dplyr 2498.6 2666.6 5131 2705.0 2849.9 129692   100   b
##  hutils  685.2  756.4 1382  784.6  823.7   7920   100  a</code></pre>
</div>
<div id="drop-columns" class="section level2">
<h2 class="hasAnchor">
<a href="#drop-columns" class="anchor"></a>Drop columns</h2>
<p>To drop a column from a <code>data.table</code>, you set it to <code>NULL</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">A =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">B =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">C =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)
DT[, A <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="ot">NULL</span>]</code></pre></div>
<p>There’s nothing wrong with this, but I’ve found the following a useful alias, especially in a <code>magrittr</code> pipe.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">A =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">B =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">C =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)
DT <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/drop_col.html">drop_col</a></span>(<span class="st">"A"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/drop_col.html">drop_col</a></span>(<span class="st">"B"</span>)</code></pre></div>
<pre><code>##    C
## 1: 1
## 2: 2
## 3: 3
## 4: 4
## 5: 5</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># or</span>
DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">A =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">B =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dt">C =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>)
DT <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/drop_col.html">drop_cols</a></span>(<span class="kw">c</span>(<span class="st">"A"</span>, <span class="st">"B"</span>))</code></pre></div>
<pre><code>##    C
## 1: 1
## 2: 2
## 3: 3
## 4: 4
## 5: 5</code></pre>
<p>These functions simple invoke the canonical form, so won’t be any faster.</p>
<p>Additionally, one can drop columns by a regular expression using <code>drop_colr</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(flights)

flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/drop_colr.html">drop_colr</a></span>(<span class="st">"time"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/drop_colr.html">drop_colr</a></span>(<span class="st">"arr(?!_delay)"</span>, <span class="dt">perl =</span> <span class="ot">TRUE</span>)</code></pre></div>
<pre><code>##         year month day dep_delay arr_delay flight tailnum origin dest
##      1: 2013     1   1         2        11   1545  N14228    EWR  IAH
##      2: 2013     1   1         4        20   1714  N24211    LGA  IAH
##      3: 2013     1   1         2        33   1141  N619AA    JFK  MIA
##      4: 2013     1   1        -1       -18    725  N804JB    JFK  BQN
##      5: 2013     1   1        -6       -25    461  N668DN    LGA  ATL
##     ---                                                              
## 336772: 2013     9  30        NA        NA   3393    &lt;NA&gt;    JFK  DCA
## 336773: 2013     9  30        NA        NA   3525    &lt;NA&gt;    LGA  SYR
## 336774: 2013     9  30        NA        NA   3461  N535MQ    LGA  BNA
## 336775: 2013     9  30        NA        NA   3572  N511MQ    LGA  CLE
## 336776: 2013     9  30        NA        NA   3531  N839MQ    LGA  RDU
##         distance hour minute
##      1:     1400    5     15
##      2:     1416    5     29
##      3:     1089    5     40
##      4:     1576    5     45
##      5:      762    6      0
##     ---                     
## 336772:      213   14     55
## 336773:      198   22      0
## 336774:      764   12     10
## 336775:      419   11     59
## 336776:      431    8     40</code></pre>
</div>
<div id="drop_constant_cols" class="section level2">
<h2 class="hasAnchor">
<a href="#drop_constant_cols" class="anchor"></a><code>drop_constant_cols</code>
</h2>
<p>When a table is filtered, the filtrate is often redundant.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span>.[origin <span class="op">==</span><span class="st"> "JFK"</span>] <span class="op">%&gt;%</span>
<span class="st">  </span>drop_constant_cols</code></pre></div>
<pre><code>##         month day dep_time sched_dep_time dep_delay arr_time
##      1:     1   1      542            540         2      923
##      2:     1   1      544            545        -1     1004
##      3:     1   1      557            600        -3      838
##      4:     1   1      558            600        -2      849
##      5:     1   1      558            600        -2      853
##     ---                                                     
## 111275:     9  30     2240           2250       -10     2347
## 111276:     9  30     2241           2246        -5     2345
## 111277:     9  30     2307           2255        12     2359
## 111278:     9  30     2349           2359       -10      325
## 111279:     9  30       NA           1455        NA       NA
##         sched_arr_time arr_delay carrier flight tailnum dest air_time
##      1:            850        33      AA   1141  N619AA  MIA      160
##      2:           1022       -18      B6    725  N804JB  BQN      183
##      3:            846        -8      B6     79  N593JB  MCO      140
##      4:            851        -2      B6     49  N793JB  PBI      149
##      5:            856        -3      B6     71  N657JB  TPA      158
##     ---                                                              
## 111275:              7       -20      B6   2002  N281JB  BUF       52
## 111276:              1       -16      B6    486  N346JB  ROC       47
## 111277:           2358         1      B6    718  N565JB  BOS       33
## 111278:            350       -25      B6    745  N516JB  PSE      196
## 111279:           1634        NA      9E   3393    &lt;NA&gt;  DCA       NA
##         distance hour minute           time_hour
##      1:     1089    5     40 2013-01-01 05:00:00
##      2:     1576    5     45 2013-01-01 05:00:00
##      3:      944    6      0 2013-01-01 06:00:00
##      4:     1028    6      0 2013-01-01 06:00:00
##      5:     1005    6      0 2013-01-01 06:00:00
##     ---                                         
## 111275:      301   22     50 2013-09-30 22:00:00
## 111276:      264   22     46 2013-09-30 22:00:00
## 111277:      187   22     55 2013-09-30 22:00:00
## 111278:     1617   23     59 2013-09-30 23:00:00
## 111279:      213   14     55 2013-09-30 14:00:00</code></pre>
</div>
<div id="drop_empty_cols" class="section level2">
<h2 class="hasAnchor">
<a href="#drop_empty_cols" class="anchor"></a><code>drop_empty_cols</code>
</h2>
<p>This function drops columns in which all the values are <code>NA</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">planes <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>as.data.table <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>.[<span class="op">!</span><span class="kw">complete.cases</span>(.)]</code></pre></div>
<pre><code>##       tailnum year                    type                  manufacturer
##    1:  N10156 2004 Fixed wing multi engine                       EMBRAER
##    2:  N102UW 1998 Fixed wing multi engine              AIRBUS INDUSTRIE
##    3:  N103US 1999 Fixed wing multi engine              AIRBUS INDUSTRIE
##    4:  N104UW 1999 Fixed wing multi engine              AIRBUS INDUSTRIE
##    5:  N10575 2002 Fixed wing multi engine                       EMBRAER
##   ---                                                                   
## 3295:  N997AT 2002 Fixed wing multi engine                        BOEING
## 3296:  N997DL 1992 Fixed wing multi engine MCDONNELL DOUGLAS AIRCRAFT CO
## 3297:  N998AT 2002 Fixed wing multi engine                        BOEING
## 3298:  N998DL 1992 Fixed wing multi engine MCDONNELL DOUGLAS CORPORATION
## 3299:  N999DN 1992 Fixed wing multi engine MCDONNELL DOUGLAS CORPORATION
##           model engines seats speed    engine
##    1: EMB-145XR       2    55    NA Turbo-fan
##    2:  A320-214       2   182    NA Turbo-fan
##    3:  A320-214       2   182    NA Turbo-fan
##    4:  A320-214       2   182    NA Turbo-fan
##    5: EMB-145LR       2    55    NA Turbo-fan
##   ---                                        
## 3295:   717-200       2   100    NA Turbo-fan
## 3296:     MD-88       2   142    NA Turbo-fan
## 3297:   717-200       2   100    NA Turbo-fan
## 3298:     MD-88       2   142    NA Turbo-jet
## 3299:     MD-88       2   142    NA Turbo-jet</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">planes <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>as.data.table <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>.[<span class="op">!</span><span class="kw">complete.cases</span>(.)] <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co"># drops speed</span>
<span class="st">  </span>drop_empty_cols</code></pre></div>
<pre><code>##       tailnum year                    type                  manufacturer
##    1:  N10156 2004 Fixed wing multi engine                       EMBRAER
##    2:  N102UW 1998 Fixed wing multi engine              AIRBUS INDUSTRIE
##    3:  N103US 1999 Fixed wing multi engine              AIRBUS INDUSTRIE
##    4:  N104UW 1999 Fixed wing multi engine              AIRBUS INDUSTRIE
##    5:  N10575 2002 Fixed wing multi engine                       EMBRAER
##   ---                                                                   
## 3295:  N997AT 2002 Fixed wing multi engine                        BOEING
## 3296:  N997DL 1992 Fixed wing multi engine MCDONNELL DOUGLAS AIRCRAFT CO
## 3297:  N998AT 2002 Fixed wing multi engine                        BOEING
## 3298:  N998DL 1992 Fixed wing multi engine MCDONNELL DOUGLAS CORPORATION
## 3299:  N999DN 1992 Fixed wing multi engine MCDONNELL DOUGLAS CORPORATION
##           model engines seats    engine
##    1: EMB-145XR       2    55 Turbo-fan
##    2:  A320-214       2   182 Turbo-fan
##    3:  A320-214       2   182 Turbo-fan
##    4:  A320-214       2   182 Turbo-fan
##    5: EMB-145LR       2    55 Turbo-fan
##   ---                                  
## 3295:   717-200       2   100 Turbo-fan
## 3296:     MD-88       2   142 Turbo-fan
## 3297:   717-200       2   100 Turbo-fan
## 3298:     MD-88       2   142 Turbo-jet
## 3299:     MD-88       2   142 Turbo-jet</code></pre>
</div>
<div id="duplicated_rows" class="section level2">
<h2 class="hasAnchor">
<a href="#duplicated_rows" class="anchor"></a><code>duplicated_rows</code>
</h2>
<p>There are many useful functions for detecting duplicates in R. However, in interactive use, I often want to not merely see which values are duplicated, but also compare them to the original. This is especially true when I am comparing duplicates across a <em>subset</em> of columns in a a <code>data.table</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># only the 'second' of the duplicates is returned</span>
<span class="st">  </span>.[<span class="kw">duplicated</span>(., <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"origin"</span>, <span class="st">"dest"</span>))]  </code></pre></div>
<pre><code>##         year month day dep_time sched_dep_time dep_delay arr_time
##      1: 2013     1   1      600            600         0      837
##      2: 2013     1   1      607            607         0      858
##      3: 2013     1   1      608            600         8      807
##      4: 2013     1   1      623            627        -4      933
##      5: 2013     1   1      624            630        -6      840
##     ---                                                          
## 336548: 2013     9  30       NA           1455        NA       NA
## 336549: 2013     9  30       NA           2200        NA       NA
## 336550: 2013     9  30       NA           1210        NA       NA
## 336551: 2013     9  30       NA           1159        NA       NA
## 336552: 2013     9  30       NA            840        NA       NA
##         sched_arr_time arr_delay carrier flight tailnum origin dest
##      1:            825        12      MQ   4650  N542MQ    LGA  ATL
##      2:            915       -17      UA   1077  N53442    EWR  MIA
##      3:            735        32      MQ   3768  N9EAMQ    EWR  ORD
##      4:            932         1      UA    496  N459UA    LGA  IAH
##      5:            830        10      MQ   4599  N518MQ    LGA  MSP
##     ---                                                            
## 336548:           1634        NA      9E   3393    &lt;NA&gt;    JFK  DCA
## 336549:           2312        NA      9E   3525    &lt;NA&gt;    LGA  SYR
## 336550:           1330        NA      MQ   3461  N535MQ    LGA  BNA
## 336551:           1344        NA      MQ   3572  N511MQ    LGA  CLE
## 336552:           1020        NA      MQ   3531  N839MQ    LGA  RDU
##         air_time distance hour minute           time_hour
##      1:      134      762    6      0 2013-01-01 06:00:00
##      2:      157     1085    6      7 2013-01-01 06:00:00
##      3:      139      719    6      0 2013-01-01 06:00:00
##      4:      229     1416    6     27 2013-01-01 06:00:00
##      5:      166     1020    6     30 2013-01-01 06:00:00
##     ---                                                  
## 336548:       NA      213   14     55 2013-09-30 14:00:00
## 336549:       NA      198   22      0 2013-09-30 22:00:00
## 336550:       NA      764   12     10 2013-09-30 12:00:00
## 336551:       NA      419   11     59 2013-09-30 11:00:00
## 336552:       NA      431    8     40 2013-09-30 08:00:00</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Both rows are returned and (by default)</span>
<span class="st">  </span><span class="co"># duplicates are presented adjacently</span>
<span class="st">  </span><span class="kw"><a href="../reference/duplicated_rows.html">duplicated_rows</a></span>(<span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"origin"</span>, <span class="st">"dest"</span>))</code></pre></div>
<pre><code>##         year month day dep_time sched_dep_time dep_delay arr_time
##      1: 2013     1   1     1315           1317        -2     1413
##      2: 2013     1   1     1655           1621        34     1804
##      3: 2013     1   1     2056           2004        52     2156
##      4: 2013     1   2     1332           1327         5     1419
##      5: 2013     1   2     1746           1621        85     1835
##     ---                                                          
## 336767: 2013     9  27     1516           1520        -4     1739
## 336768: 2013     9  29     1754           1755        -1     2019
## 336769: 2013     9  30      719            725        -6      916
## 336770: 2013     9  30     1519           1520        -1     1726
## 336771: 2013     9  30     1747           1755        -8     1941
##         sched_arr_time arr_delay carrier flight tailnum origin dest
##      1:           1423       -10      EV   4112  N13538    EWR  ALB
##      2:           1724        40      EV   3260  N19554    EWR  ALB
##      3:           2112        44      EV   4170  N12540    EWR  ALB
##      4:           1433       -14      EV   4316  N14153    EWR  ALB
##      5:           1724        71      EV   3260  N14153    EWR  ALB
##     ---                                                            
## 336767:           1740        -1      MQ   3532  N724MQ    LGA  XNA
## 336768:           2015         4      MQ   3713  N725MQ    LGA  XNA
## 336769:            945       -29      MQ   3547  N735MQ    LGA  XNA
## 336770:           1740       -14      MQ   3532  N725MQ    LGA  XNA
## 336771:           2015       -34      MQ   3713  N720MQ    LGA  XNA
##         air_time distance hour minute           time_hour
##      1:       33      143   13     17 2013-01-01 13:00:00
##      2:       36      143   16     21 2013-01-01 16:00:00
##      3:       31      143   20      4 2013-01-01 20:00:00
##      4:       33      143   13     27 2013-01-02 13:00:00
##      5:       31      143   16     21 2013-01-02 16:00:00
##     ---                                                  
## 336767:      160     1147   15     20 2013-09-27 15:00:00
## 336768:      160     1147   17     55 2013-09-29 17:00:00
## 336769:      150     1147    7     25 2013-09-30 07:00:00
## 336770:      148     1147   15     20 2013-09-30 15:00:00
## 336771:      146     1147   17     55 2013-09-30 17:00:00</code></pre>
</div>
<div id="haversine-distance" class="section level2">
<h2 class="hasAnchor">
<a href="#haversine-distance" class="anchor"></a>Haversine distance</h2>
<p>To emphasize the miscellany of this package, I now present <code>haversine_distance</code> which simply returns the distance between two points on the Earth, given their latitutde and longitude.</p>
<p>I prefer this to other packages’ implementations. Although the <code>geosphere</code> package can do a lot more than calculate distances between points, I find the interface for <code>distHaversine</code> unfortunate as it cannot be easily used inside a <code>data.frame</code>. In addition, I’ve found the arguments clearer in <code><a href="../reference/haversine_distance.html">hutils::haversine_distance</a></code> rather than trying to remember whether to use <code>byrow</code> inside the <code>matrix</code> function while passing to <code>distHaversine</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT1 &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">lat_orig =</span> <span class="kw">runif</span>(<span class="fl">1e5</span>, <span class="op">-</span><span class="dv">80</span>, <span class="dv">80</span>),
                  <span class="dt">lon_orig =</span> <span class="kw">runif</span>(<span class="fl">1e5</span>, <span class="op">-</span><span class="dv">179</span>, <span class="dv">179</span>),
                  <span class="dt">lat_dest =</span> <span class="kw">runif</span>(<span class="fl">1e5</span>, <span class="op">-</span><span class="dv">80</span>, <span class="dv">80</span>),
                  <span class="dt">lon_dest =</span> <span class="kw">runif</span>(<span class="fl">1e5</span>, <span class="op">-</span><span class="dv">179</span>, <span class="dv">179</span>))

DT2 &lt;-<span class="st"> </span><span class="kw">copy</span>(DT1)

<span class="kw">microbenchmark</span>(DT1[, distance <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../reference/haversine_distance.html">haversine_distance</a></span>(lat_orig, lon_orig,
                                                    lat_dest, lon_dest)],
               
               DT2[, distance <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">distHaversine</span>(<span class="kw">cbind</span>(lon_orig, lat_orig),
                                               <span class="kw">cbind</span>(lon_orig, lat_orig))])</code></pre></div>
<pre><code>## Unit: milliseconds
##                                                                                             expr
##           DT1[, `:=`(distance, haversine_distance(lat_orig, lon_orig, lat_dest,      lon_dest))]
##  DT2[, `:=`(distance, distHaversine(cbind(lon_orig, lat_orig),      cbind(lon_orig, lat_orig)))]
##    min    lq  mean median    uq    max neval cld
##  20.70 21.25 22.99  21.33 21.45  38.65   100  a 
##  37.33 38.10 47.59  46.34 50.76 180.62   100   b</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">rm</span>(DT1, DT2)</code></pre></div>
</div>
<div id="mutate_other" class="section level2">
<h2 class="hasAnchor">
<a href="#mutate_other" class="anchor"></a><code>mutate_other</code>
</h2>
<p>There may be occasions where a categorical variable in a <code>data.table</code> may need to modified to reduce the number of distinct categories. For example, you may want to plot a chart with a set number of facets, or ensure the smooth operation of <code>randomForest</code>, which accepts no more than 32 levels in a feature.</p>
<p><code>mutate_other</code> keeps the <em>n</em> most common categories and changes the other categories to <code>Other</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1</span>)
DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">Fruit =</span> <span class="kw">sample</span>(<span class="kw">c</span>(<span class="st">"apple"</span>, <span class="st">"pear"</span>, <span class="st">"orange"</span>, <span class="st">"tomato"</span>, <span class="st">"eggplant"</span>),
                                <span class="dt">size =</span> <span class="dv">20</span>,
                                <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.45</span>, <span class="fl">0.25</span>, <span class="fl">0.15</span>, <span class="fl">0.1</span>, <span class="fl">0.05</span>),
                                <span class="dt">replace =</span> <span class="ot">TRUE</span>),
                 <span class="dt">Price =</span> <span class="kw">rpois</span>(<span class="dv">20</span>, <span class="dv">10</span>))

<span class="kw">kable</span>(<span class="kw"><a href="../reference/mutate_other.html">mutate_other</a></span>(DT, <span class="st">"Fruit"</span>, <span class="dt">n =</span> <span class="dv">3</span>)[])</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Fruit</th>
<th align="right">Price</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">apple</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">apple</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">pear</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">apple</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">Other</td>
<td align="right">7</td>
</tr>
<tr class="even">
<td align="left">pear</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">pear</td>
<td align="right">11</td>
</tr>
<tr class="even">
<td align="left">apple</td>
<td align="right">12</td>
</tr>
<tr class="odd">
<td align="left">apple</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">apple</td>
<td align="right">10</td>
</tr>
<tr class="odd">
<td align="left">pear</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="left">apple</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">Other</td>
<td align="right">13</td>
</tr>
<tr class="even">
<td align="left">pear</td>
<td align="right">7</td>
</tr>
<tr class="odd">
<td align="left">Other</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">apple</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">Other</td>
<td align="right">9</td>
</tr>
</tbody>
</table>
</div>
<div id="ngrep" class="section level2">
<h2 class="hasAnchor">
<a href="#ngrep" class="anchor"></a><code>ngrep</code>
</h2>
<p>This is a ‘dumb’ negation of <code>grep</code>. In recent versions of R, the option <code>invert = FALSE</code> exists. A slight advantage of <code>ngrep</code> is that it’s shorter to type. But if you don’t have arthritis, best use <code>invert = FALSE</code> or <code>!grepl</code>.</p>
</div>
<div id="notin-ein-enotin-pin" class="section level2">
<h2 class="hasAnchor">
<a href="#notin-ein-enotin-pin" class="anchor"></a><code>notin</code> <code>ein</code> <code>enotin</code> <code>pin</code>
</h2>
<p>These functions provide complementary functionality to <code>%in%</code>:</p>
<div id="notin" class="section level3">
<h3 class="hasAnchor">
<a href="#notin" class="anchor"></a><code>%notin%</code>
</h3>
<p><code>%notin%</code> is the negation of <code>%in%</code>, but also uses the package <code>fastmatch</code> to increase the speed of the operation</p>
</div>
<div id="ein-and-enotin" class="section level3">
<h3 class="hasAnchor">
<a href="#ein-and-enotin" class="anchor"></a><code>%ein%</code> and <code>%enotin%</code>
</h3>
<p>The functions <code>%ein%</code> and <code>%enotin%</code> are motivated by a different sort of problem. Consider the following statement:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(iris)
iris[Species <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"setosa"</span>, <span class="st">"versicolour"</span>)] <span class="op">%$%</span>
<span class="st">  </span><span class="kw">mean</span>(Sepal.Length <span class="op">/</span><span class="st"> </span>Sepal.Width)</code></pre></div>
<pre><code>## [1] 1.47</code></pre>
<p>On the face of it, this appears to give the average ratio of <em>Iris setosa</em> and <em>Iris versicolour</em> irises. However, it only gives the average ratio of <em>setosa</em> irises, as the correct spelling is <em>Iris versicolor</em> not <em>-our</em>. This particular error is easy to make, (in fact when I wrote this vignette, the first hit of Google for <code>iris dataset</code> made the same spelling error), but it’s easy to imagine similar mistakes, such as mistaking the capitalization of a value. The functions <code>%ein%</code> and <code>%enotin%</code> strive to reduce the occurence of this mistake. The functions operate exactly the same as <code>%in%</code> and <code>%enotin%</code> but error if any of the table of values to be matched against is not present in any of the values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris &lt;-<span class="st"> </span><span class="kw">as.data.table</span>(iris)
iris[Species <span class="op">%ein%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"setosa"</span>, <span class="st">"versicolour"</span>)] <span class="op">%$%</span>
<span class="st">  </span><span class="kw">mean</span>(Sepal.Length <span class="op">/</span><span class="st"> </span>Sepal.Width)</code></pre></div>
<pre><code>## Error: `rhs` contained versicolour, but this value was not found in `lhs = Species`. All values of `rhs` must be in `lhs`. Ensure you have specified `rhs` correctly.</code></pre>
<p>The <code>e</code> stands for ‘exists’; <em>i.e.</em> they should be read as “exists and in” and “exists and not in”.</p>
</div>
<div id="pin" class="section level3">
<h3 class="hasAnchor">
<a href="#pin" class="anchor"></a><code>%pin%</code>
</h3>
<p>This performs a partial match (<em>i.e</em> <code>grepl</code>) but with a possibly more readable or intuitive syntax</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">identical</span>(iris[<span class="kw">grep</span>(<span class="st">"v"</span>, Species)],
          iris[Species <span class="op">%pin%</span><span class="st"> "v"</span>])</code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>If the RHS has more than one element, the matching is done on alternation (<em>i.e.</em> OR):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">iris[Species <span class="op">%pin%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"ver"</span>, <span class="st">"vir"</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>head</code></pre></div>
<pre><code>##    Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
## 1:          7.0         3.2          4.7         1.4 versicolor
## 2:          6.4         3.2          4.5         1.5 versicolor
## 3:          6.9         3.1          4.9         1.5 versicolor
## 4:          5.5         2.3          4.0         1.3 versicolor
## 5:          6.5         2.8          4.6         1.5 versicolor
## 6:          5.7         2.8          4.5         1.3 versicolor</code></pre>
<p>There is an important qualification: if the RHS is <code>NULL</code>, then the result will be <code>TRUE</code> along the length of <code>x</code>, contrary to the behaviour of <code>%in%</code>. This is not entirely unexpected as <code>NULL</code> could legitimately be interpreted as <span class="math inline">\(\varepsilon\)</span>, the empty regular expression, which occurs in every string.</p>
</div>
<div id="provide-dir" class="section level3">
<h3 class="hasAnchor">
<a href="#provide-dir" class="anchor"></a><code>provide.dir</code>
</h3>
<p>This is the same as <code>dir.create</code> but checks whether the target exists or not and does nothing if it does. Motivated by <code>\providecommand</code> in <span class="math inline">\(\rm\LaTeX{}\)</span>, which creates a macro only if it does not exist already.</p>
</div>
<div id="select_which" class="section level3">
<h3 class="hasAnchor">
<a href="#select_which" class="anchor"></a><code>select_which</code>
</h3>
<p>This provides a similar role to <code><a href="http://dplyr.tidyverse.org/reference/select_all.html">dplyr::select_if</a></code> but was originally part of <code>package:grattan</code> so has a different name. It simply returns the columns whose <em>values</em> return <code>TRUE</code> when <code>Which</code> is applied. Additional columns (which may or not may satisfy <code>Which</code>) may be incldued bny using <code>.and.dots</code>. (To remove columns, you can use <code>drop_col</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">DT &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">x =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,
                 <span class="dt">y =</span> letters[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>],
                 <span class="dt">AB =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>, <span class="ot">TRUE</span>, <span class="ot">FALSE</span>))
<span class="kw"><a href="../reference/select_which.html">select_which</a></span>(DT, anyNA, <span class="dt">.and.dots =</span> <span class="st">"y"</span>)</code></pre></div>
<pre><code>##       AB y
## 1:    NA a
## 2:  TRUE b
## 3: FALSE c
## 4:  TRUE d
## 5: FALSE e</code></pre>
</div>
<div id="set_cols_first" class="section level3">
<h3 class="hasAnchor">
<a href="#set_cols_first" class="anchor"></a><code>set_cols_first</code>
</h3>
<p>Up to and including <code>data.table 1.10.4</code>, one could only reorder the columns by supplying all the columns. You can use <code>set_cols_first</code> and <code>set_cols_last</code> to put columns first or last without supplying all the columns.</p>
</div>
<div id="unique-keys" class="section level3">
<h3 class="hasAnchor">
<a href="#unique-keys" class="anchor"></a>Unique keys</h3>
<p>In some circumstances, you need to know that the <code>key</code> of a <code>data.table</code> is unique. For example, you may expect a join to be performed later, without specifying <code>mult='first'</code> or permitting Cartesian joins. <code>data.table</code> does not require a <code>key</code> to be unique and does not supply tools to check the uniqueness of keys. <code>hutils</code> supplies two simple functions: <code>has_unique_key</code> which when applied to a <code>data.table</code> returns <code>TRUE</code> if and only if the table has a key and it is unique.</p>
<p><code>set_unique_key</code> does the same as <code>setkey</code> but will error if the resultant key is not unique.</p>
</div>
</div>
<div id="hutils-v1-1-0" class="section level2">
<h2 class="hasAnchor">
<a href="#hutils-v1-1-0" class="anchor"></a><code>hutils</code> v1.1.0</h2>
<div id="auc" class="section level3">
<h3 class="hasAnchor">
<a href="#auc" class="anchor"></a><code>auc</code>
</h3>
<p>The area under the <a href="https://en.wikipedia.org/wiki/Receiver_operating_characteristic">(ROC) curve</a> gives a single value to measure the tradeoff between true positives and false positives.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dt &lt;-<span class="st"> </span><span class="kw">data.table</span>(<span class="dt">y =</span> <span class="op">!</span><span class="kw">sample</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">1</span>, <span class="dt">size =</span> <span class="dv">100</span>, <span class="dt">replace =</span> <span class="ot">TRUE</span>), 
                 <span class="dt">x =</span> <span class="kw">runif</span>(<span class="dv">100</span>))
dt[, pred <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw">predict</span>(<span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>x, <span class="dt">data =</span> .SD), <span class="dt">newdata =</span> .SD)]

dt[, <span class="kw"><a href="../reference/auc.html">auc</a></span>(y, pred)]</code></pre></div>
<pre><code>## [1] 0.533</code></pre>
</div>
<div id="select_grep" class="section level3">
<h3 class="hasAnchor">
<a href="#select_grep" class="anchor"></a><code>select_grep</code>
</h3>
<p>To select columns matching a regular expression:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/select_grep.html">select_grep</a></span>(<span class="st">"arr"</span>)</code></pre></div>
<pre><code>##         arr_time sched_arr_time arr_delay carrier
##      1:      830            819        11      UA
##      2:      850            830        20      UA
##      3:      923            850        33      AA
##      4:     1004           1022       -18      B6
##      5:      812            837       -25      DL
##     ---                                          
## 336772:       NA           1634        NA      9E
## 336773:       NA           2312        NA      9E
## 336774:       NA           1330        NA      MQ
## 336775:       NA           1344        NA      MQ
## 336776:       NA           1020        NA      MQ</code></pre>
<p>You can use the additional arguments <code>.and</code> and <code>.but.not</code> to override the patterns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/select_grep.html">select_grep</a></span>(<span class="st">"arr"</span>, <span class="dt">.and =</span> <span class="st">"year"</span>, <span class="dt">.but.not =</span> <span class="st">"arr_time"</span>)</code></pre></div>
<pre><code>##         year sched_arr_time arr_delay carrier
##      1: 2013            819        11      UA
##      2: 2013            830        20      UA
##      3: 2013            850        33      AA
##      4: 2013           1022       -18      B6
##      5: 2013            837       -25      DL
##     ---                                      
## 336772: 2013           1634        NA      9E
## 336773: 2013           2312        NA      9E
## 336774: 2013           1330        NA      MQ
## 336775: 2013           1344        NA      MQ
## 336776: 2013           1020        NA      MQ</code></pre>
</div>
</div>
<div id="hutils-v1-2-0" class="section level2">
<h2 class="hasAnchor">
<a href="#hutils-v1-2-0" class="anchor"></a><code>hutils</code> v1.2.0</h2>
<div id="rq" class="section level3">
<h3 class="hasAnchor">
<a href="#rq" class="anchor"></a><code>RQ</code>
</h3>
<p>This is simply a shorthand to test whether a package needs installing. The package name need not be quoted, for convenience.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/RQ.html">RQ</a></span>(dplyr, <span class="st">"dplyr must be installed"</span>)
<span class="kw"><a href="../reference/RQ.html">RQ</a></span>(<span class="st">"dplyr"</span>, <span class="st">"dplyr needs installing"</span>, <span class="st">"dplyr installed."</span>)</code></pre></div>
<pre><code>## [1] "dplyr installed."</code></pre>
</div>
<div id="ahull" class="section level3">
<h3 class="hasAnchor">
<a href="#ahull" class="anchor"></a><code>ahull</code>
</h3>
<p>This locates the biggest rectangle beneath a curve:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(<span class="kw">data.table</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="dt">y =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">0.1</span>, <span class="dv">0</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_area</span>(<span class="kw">aes</span>(x, y)) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> <span class="kw"><a href="../reference/ahull.html">ahull</a></span>(, <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="fl">0.1</span>, <span class="dv">0</span>)),
            <span class="kw">aes</span>(<span class="dt">xmin =</span> xmin,
                <span class="dt">xmax =</span> xmax,
                <span class="dt">ymin =</span> ymin,
                <span class="dt">ymax =</span> ymax),
            <span class="dt">color =</span> <span class="st">"red"</span>) </code></pre></div>
<p><img src="hutils_files/figure-html/ahull-1-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">101</span>)
ahull_dt &lt;-
<span class="st">  </span><span class="kw">data.table</span>(<span class="dt">x =</span> <span class="kw">c</span>(<span class="dv">0</span><span class="op">:</span><span class="dv">100</span>) <span class="op">/</span><span class="st"> </span><span class="dv">100</span>,
             <span class="dt">y =</span> <span class="kw">cumsum</span>(<span class="kw">rnorm</span>(<span class="dv">101</span>, <span class="fl">0.05</span>)))
<span class="kw">ggplot</span>(ahull_dt) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_area</span>(<span class="kw">aes</span>(x, y)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> <span class="kw"><a href="../reference/ahull.html">ahull</a></span>(ahull_dt), 
            <span class="kw">aes</span>(<span class="dt">xmin =</span> xmin, 
                <span class="dt">xmax =</span> xmax, 
                <span class="dt">ymin =</span> ymin, 
                <span class="dt">ymax =</span> ymax), 
            <span class="dt">color =</span> <span class="st">"red"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> <span class="kw"><a href="../reference/ahull.html">ahull</a></span>(ahull_dt,
                         <span class="dt">incl_negative =</span> <span class="ot">TRUE</span>), 
            <span class="kw">aes</span>(<span class="dt">xmin =</span> xmin, 
                <span class="dt">xmax =</span> xmax, 
                <span class="dt">ymin =</span> ymin, 
                <span class="dt">ymax =</span> ymax), 
            <span class="dt">color =</span> <span class="st">"blue"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> <span class="kw"><a href="../reference/ahull.html">ahull</a></span>(ahull_dt,
                         <span class="dt">incl_negative =</span> <span class="ot">TRUE</span>,
                         <span class="dt">minH =</span> <span class="dv">4</span>), 
            <span class="kw">aes</span>(<span class="dt">xmin =</span> xmin, 
                <span class="dt">xmax =</span> xmax, 
                <span class="dt">ymin =</span> ymin, 
                <span class="dt">ymax =</span> ymax), 
            <span class="dt">color =</span> <span class="st">"green"</span>) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_rect</span>(<span class="dt">data =</span> <span class="kw"><a href="../reference/ahull.html">ahull</a></span>(ahull_dt,
                         <span class="dt">incl_negative =</span> <span class="ot">TRUE</span>,
                         <span class="dt">minW =</span> <span class="fl">0.25</span>), 
            <span class="kw">aes</span>(<span class="dt">xmin =</span> xmin, 
                <span class="dt">xmax =</span> xmax, 
                <span class="dt">ymin =</span> ymin, 
                <span class="dt">ymax =</span> ymax), 
            <span class="dt">color =</span> <span class="st">"white"</span>,
            <span class="dt">fill =</span> <span class="ot">NA</span>)</code></pre></div>
<p><img src="hutils_files/figure-html/ahull-demos-1.png" width="768"></p>
</div>
</div>
<div id="hutils-v1-3-0" class="section level2">
<h2 class="hasAnchor">
<a href="#hutils-v1-3-0" class="anchor"></a><code>hutils</code> v1.3.0</h2>
<div id="weighted_quantile" class="section level3">
<h3 class="hasAnchor">
<a href="#weighted_quantile" class="anchor"></a><code>weighted_quantile</code>
</h3>
<p>Simply a version of <code>quantile</code> supporting weighted values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">10</span>
w &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">5</span>), <span class="kw">rep</span>(<span class="dv">2</span>, <span class="dv">5</span>))
<span class="kw">quantile</span>(x, <span class="dt">prob =</span> <span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>), <span class="dt">names =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>## [1] 3.25 7.75</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/weighted_quantile.html">weighted_quantile</a></span>(x, w, <span class="dt">p =</span> <span class="kw">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>))</code></pre></div>
<pre><code>## [1] 4 9</code></pre>
</div>
<div id="mutate_ntile" class="section level3">
<h3 class="hasAnchor">
<a href="#mutate_ntile" class="anchor"></a><code>mutate_ntile</code>
</h3>
<p>To add a column of ntiles (say, for later summarizing):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span>as.data.table <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(year, month, day, origin, dest, distance)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/mutate_ntile.html">mutate_ntile</a></span>(distance, <span class="dt">n =</span> 5L)</code></pre></div>
<pre><code>##         year month day origin dest distance distanceQuintile
##      1: 2013     1   1    EWR  IAH     1400                4
##      2: 2013     1   1    LGA  IAH     1416                4
##      3: 2013     1   1    JFK  MIA     1089                4
##      4: 2013     1   1    JFK  BQN     1576                4
##      5: 2013     1   1    LGA  ATL      762                3
##     ---                                                     
## 336772: 2013     9  30    JFK  DCA      213                1
## 336773: 2013     9  30    LGA  SYR      198                1
## 336774: 2013     9  30    LGA  BNA      764                3
## 336775: 2013     9  30    LGA  CLE      419                1
## 336776: 2013     9  30    LGA  RDU      431                2</code></pre>
<p>You can use non-standard evaluation (as above) or you can quote the <code>col</code> argument. Use <code>character.only = TRUE</code> to ensure column is only interpreted as character.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span>as.data.table <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(year, month, day, origin, dest, distance)] <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/mutate_ntile.html">mutate_ntile</a></span>(distance, <span class="dt">n =</span> 5L)</code></pre></div>
<pre><code>##         year month day origin dest distance distanceQuintile
##      1: 2013     1   1    EWR  IAH     1400                4
##      2: 2013     1   1    LGA  IAH     1416                4
##      3: 2013     1   1    JFK  MIA     1089                4
##      4: 2013     1   1    JFK  BQN     1576                4
##      5: 2013     1   1    LGA  ATL      762                3
##     ---                                                     
## 336772: 2013     9  30    JFK  DCA      213                1
## 336773: 2013     9  30    LGA  SYR      198                1
## 336774: 2013     9  30    LGA  BNA      764                3
## 336775: 2013     9  30    LGA  CLE      419                1
## 336776: 2013     9  30    LGA  RDU      431                2</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">flights <span class="op">%&gt;%</span>
<span class="st">  </span>as.data.table <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw"><a href="../reference/mutate_ntile.html">mutate_ntile</a></span>(<span class="st">"distance"</span>,
               <span class="dt">n =</span> 5L,
               <span class="dt">character.only =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span>.[, dep_delay <span class="op">:</span><span class="er">=</span><span class="st"> </span><span class="kw"><a href="../reference/coalesce.html">coalesce</a></span>(dep_delay, <span class="dv">0</span>)] <span class="op">%&gt;%</span>
<span class="st">  </span>.[, .(<span class="dt">avgDelay =</span> <span class="kw">mean</span>(dep_delay)), keyby =<span class="st"> "distanceQuintile"</span>]</code></pre></div>
<pre><code>##    distanceQuintile avgDelay
## 1:                1    12.88
## 2:                2    12.97
## 3:                3    13.14
## 4:                4    11.49
## 5:                5    11.16</code></pre>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#hutils-package"><code>hutils</code> package</a><ul class="nav nav-pills nav-stacked">
<li><a href="#aliases">Aliases</a></li>
      <li><a href="#coalesce-and-if_else"><code>coalesce</code> and <code>if_else</code></a></li>
      <li><a href="#drop-columns">Drop columns</a></li>
      <li><a href="#drop_constant_cols"><code>drop_constant_cols</code></a></li>
      <li><a href="#drop_empty_cols"><code>drop_empty_cols</code></a></li>
      <li><a href="#duplicated_rows"><code>duplicated_rows</code></a></li>
      <li><a href="#haversine-distance">Haversine distance</a></li>
      <li><a href="#mutate_other"><code>mutate_other</code></a></li>
      <li><a href="#ngrep"><code>ngrep</code></a></li>
      <li><a href="#notin-ein-enotin-pin"><code>notin</code> <code>ein</code> <code>enotin</code> <code>pin</code></a></li>
      <li><a href="#hutils-v1-1-0"><code>hutils</code> v1.1.0</a></li>
      <li><a href="#hutils-v1-2-0"><code>hutils</code> v1.2.0</a></li>
      <li><a href="#hutils-v1-3-0"><code>hutils</code> v1.3.0</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Hugh Parsonage.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
